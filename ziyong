# ####################################################################
# #
# #      â€œç”Ÿäº§ç¯å¢ƒç»ˆç‰ˆâ€ (å·²æ”¯æŒå¤šå°NAS PTè®¾å¤‡)
# #         åç»­ä»…éœ€æ ¹æ®æœºåœºèŠ‚ç‚¹æ›´æ–°æˆ–æ–°å¢ä¸šåŠ¡åœºæ™¯ï¼Œ
# #         åœ¨ â€œè‡ªå®šä¹‰è§„åˆ™åŒºåŸŸâ€ è¡¥å……è§„åˆ™å³å¯ï¼Œæ ¸å¿ƒé…ç½®æ— éœ€è°ƒæ•´
# ####################################################################

# --- æœºåœºè®¢é˜…ã€é¢„ç½®èŠ‚ç‚¹ ---
proxy-providers:
  Airport1:
    url: "ä½ çš„æœºåœºé“¾æ¥ï¼Œæ›¿æ¢åŒå¼•å·ä¹‹å†…çš„æ–‡å­—"
    type: http
    interval: 86400
    health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 300}
    proxy: ç›´è¿
proxies:
  - {name: ç›´è¿, type: direct}
  - {name: REJECT, type: reject}

# --- å…¨å±€é…ç½® ---
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7894
allow-lan: true
lan-allowed-ips: ["192.168.0.0/16", "10.0.0.0/8", "172.16.0.0/12"]
bind-address: "*"
ipv6: false
unified-delay: true
tcp-concurrent: true
tcp-fast-open: true
reuse-address: true
keep-alive: true
log-level: warning
profile: {store-selected: true, store-fake-ip: true}

# --- å¤–éƒ¨æ§åˆ¶å™¨é…ç½® ---
external-controller: 0.0.0.0:9090
secret: ""

# --- å—…æ¢ã€å…¥ç«™ ---
sniffer:
  enable: true
  sniff: {HTTP: {ports: [80, 8080-8880], override-destination: true}, TLS: {ports: [443, 8443]}, QUIC: {ports: [443, 8443]}}
  force-domain: ["+.v2ex.com"]
  skip-domain: ["+.baidu.com"]
tun:
  enable: true
  stack: gvisor
  dns-hijack: ["any:53", "tcp://any:53", "udp://any:53"]
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

# --- DNSæ¨¡å— ---
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  respect-rules: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  disable-cache: false
  cache-size: 4096
  cache-ttl: 3600
  edns: false
  fake-ip-filter:
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.local"
    - "rule-set:private_domain,cn_domain,pt_rules,docker"
    - "+.tracker"
    - "+.torrent"
    - "+.docker.com"
    - "+.docker.io"
  default-nameserver: [223.5.5.5, 119.29.29.29]
  proxy-server-nameserver: [https://223.5.5.5/dns-query, 223.6.6.6]
  nameserver: [223.5.5.5, 119.29.29.29]

# ----------------------------------------------------------------
# ç­–ç•¥ç»„ (proxy-groups )
# ----------------------------------------------------------------
proxy-groups:
  - {name: ğŸš€ é»˜è®¤ä»£ç†, type: select, proxies: [â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸ”¯ æ•…éšœè½¬ç§», ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿]}
  - {name: ğŸ¥ NETFLIX, type: select, proxies: [â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ç›´è¿]}
  - {name: ğŸ¤– ChatGPT, type: select, proxies: [â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ç›´è¿]}
  - {name: ğŸµ TikTok, type: select, proxies: [â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹]}
  - {name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [ğŸš€ é»˜è®¤ä»£ç†, ç›´è¿]}
  - name: ğŸ’» PTè®¾å¤‡ä¸“ç”¨
    type: url-test
    url: https://www.gstatic.com/generate_204
    fallback-url: http://www.apple.com/library/test/success.html
    interval: 1800
    timeout: 5000
    use: [Airport1]
    filter: '^(?!.*(ç›´è¿|REJECT )).*$'

  # --- èŠ‚ç‚¹ç­›é€‰ç»„ ---
  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, type: select, use: [Airport1], filter: "(?i)æ¸¯|hk|hongkong|hong kong"}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, type: select, use: [Airport1], filter: "(?i)æ—¥|jp|japan"}
  - {name: ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, type: select, use: [Airport1], filter: "(?i)æ–°åŠ å¡|å¡|ç‹®åŸ|SG|Singapore"}
  - {name: ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, type: select, use: [Airport1], filter: "(?i)ç¾|us|unitedstates|united states"}
  - name: ğŸ”¯ æ•…éšœè½¬ç§»
    type: fallback
    use: [Airport1]
    url: https://www.gstatic.com/generate_204
    fallback-url: http://www.apple.com/library/test/success.html
    interval: 300
    timeout: 5000
    filter: "(?=.*(æ¸¯|HK|(?i)Hong))^((?!(å°|æ—¥|éŸ©|æ–°|æ·±|ç¾)).)*$"
  - name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©
    type: url-test
    use: [Airport1]
    url: https://www.gstatic.com/generate_204
    fallback-url: http://www.apple.com/library/test/success.html
    interval: 900
    timeout: 5000
    filter: "^((?!ç›´è¿).)*$"
  - {name: ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, type: select, use: [Airport1]}

# ----------------------------------------------------------------
# å­è§„åˆ™é›† (Sub-Rules)
# ----------------------------------------------------------------
sub-rules:
  pt-device-rules:
    - RULE-SET,docker,ğŸš€ é»˜è®¤ä»£ç†
    - MATCH,ğŸ’» PTè®¾å¤‡ä¸“ç”¨

  pt-only-rules:
    - RULE-SET,pt_rules,ç›´è¿
    - MATCH,ğŸ’» PTè®¾å¤‡ä¸“ç”¨

# ----------------------------------------------------------------
# è§„åˆ™ (Rules)
# ----------------------------------------------------------------
rules:
  # --- PTå®¢æˆ·ç«¯è¿›ç¨‹è§„åˆ™ ---
  - PROCESS-NAME,qBittorrent,SUB-RULE,pt-only-rules
  - PROCESS-NAME,transmission-daemon,SUB-RULE,pt-only-rules
  - PROCESS-NAME,uTorrent,SUB-RULE,pt-only-rules

  # --- NAS IP åˆ†æµè§„åˆ™ (å·²è¦†ç›– 10.10.10.5-10.10.10.9) ---
  - SRC-IP-CIDR,10.10.10.5/32,SUB-RULE,pt-device-rules
  - SRC-IP-CIDR,10.10.10.6/32,SUB-RULE,pt-device-rules
  - SRC-IP-CIDR,10.10.10.7/32,SUB-RULE,pt-device-rules
  - SRC-IP-CIDR,10.10.10.8/32,SUB-RULE,pt-device-rules
  - SRC-IP-CIDR,10.10.10.9/32,SUB-RULE,pt-device-rules

  # --- åŸºç¡€ä¸å®‰å…¨è§„åˆ™ ---
  - RULE-SET,private_ip,ç›´è¿,no-resolve
  - RULE-SET,private_domain,ç›´è¿
  - RULE-SET,ai,ğŸ¤– ChatGPT
  - RULE-SET,netflix_domain,ğŸ¥ NETFLIX
  - RULE-SET,tiktok_domain,ğŸµ TikTok
  - RULE-SET,gfw,ğŸš€ é»˜è®¤ä»£ç†
  - RULE-SET,cn_domain,ç›´è¿
  - RULE-SET,cn_ip,ç›´è¿,no-resolve
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

  # --- è‡ªå®šä¹‰è§„åˆ™åŒºåŸŸ ---
  # - DOMAIN,example.com,ğŸš€ é»˜è®¤ä»£ç†

# ----------------------------------------------------------------
# è§„åˆ™æä¾›è€… (Rule Providers)
# ----------------------------------------------------------------
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  pt_rules: &pt_rules {type: inline, behavior: classical, payload: ['DOMAIN-KEYWORD,tracker', 'DOMAIN-KEYWORD,torrent', 'DOMAIN-KEYWORD,announce', 'DOMAIN-KEYWORD,scrape']}

rule-providers:
  private_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs"}
  ai: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/category-ai-!cn.mrs" }
  netflix_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.mrs"}
  tiktok_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/tiktok.mrs"}
  cn_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs"}
  gfw: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/gfw.mrs"}
  docker: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/docker.mrs"}
  pt_rules: {<<: *pt_rules}
  private_ip: {<<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/private.mrs"}
  cn_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs"}
